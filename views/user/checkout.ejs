<div class="page-header border-bottom">
    <div class="container">
        <div class="d-md-flex justify-content-between align-items-center py-4">
            <h1 class="page-title font-size-3 font-weight-medium m-0 text-lh-lg">Shop Single</h1>
            <nav class="woocommerce-breadcrumb font-size-2">
                <a href="#" class="h-primary">Home</a>
                <span class="breadcrumb-separator mx-1"><i class="fas fa-angle-right"></i></span>
                <a href="#" class="h-primary">Shop</a>
                <span class="breadcrumb-separator mx-1"><i class="fas fa-angle-right"></i></span>Shop Single
            </nav>
        </div>
    </div>
</div>
<div id="content" class="site-content bg-punch-light space-bottom-3">
    <div class="col-full container">
        <div id="primary" class="content-area">
            <main id="main" class="site-main">
                <article id="post-6" class="post-6 page type-page status-publish hentry">
                    <header class="entry-header space-top-2 space-bottom-1 mb-2">
                        <h4 class="entry-title font-size-7 text-center">Checkout</h4>
                    </header>

                    <div class="entry-content">
                        <div class="woocommerce">
                            <div class="woocommerce-info p-4 bg-white border">Have a coupon?
                                <a class="showcoupon" data-toggle="collapse" href="#collapseExample9" role="button"
                                    aria-expanded="false" aria-controls="collapseExample9">
                                    Click here to enter your code
                                </a>
                            </div>

                         <!-- add coupon -->

                            <div id="collapseExample9" class="collapse checkout_coupon mt-4 p-4 bg-white border">
                                <div class="row d-flex">
                                    
                                    <p class="col-md-4 d-inline form-row form-row-first mb-3 mb-md-0">
                                        <input type="text" name="coupon_code1" class="input-text form-control"
                                            placeholder="Coupon code" id="coupon_code1" value="" >
                                    </p>
                                    <p class="col-md-3 d-inline form-row form-row-last">
                                        
                                       <button  button type="button" onclick="applyCoupon()">Apply</button>
                                    </p>
                                    <p style="color:red ;" id="Message"></p>
                                </div>
                                <div class="clear"></div>
                            </div>




                            <form name="" method="post" id="checkout_form"
                                class="checkout woocommerce-checkout row mt-8" action="/checkout"
                                enctype="multipart/form-data" novalidate="novalidate">

                                <div class="col2-set col-md-6 col-lg-7 col-xl-8 mb-6 mb-md-0" id="customer_details">
                                    <div class="px-4 pt-5 bg-white border">
                                        <div class="woocommerce-billing-fields">
                                            <h3 class="mb-4 font-size-3">Billing details</h3>
                                            <div class="woocommerce-billing-fields__field-wrapper row">

                                                <p class="col-lg-6 mb-4d75 form-row form-row-first validate-required woocommerce-invalid woocommerce-invalid-required-field"
                                                    id="billing_first_name_field" data-priority="10">

                                                    <label for="billing_first_name" class="form-label">First
                                                        name
                                                        <abbr class="required" title="required">*</abbr></label>

                                                    <input type="text" class="input-text form-control" name="firstname"
                                                        id="first_name" placeholder="" value=""
                                                        autocomplete="given-name" autofocus="autofocus">


                                                </p>

                                                <p class="col-lg-6 mb-4d75 form-row form-row-last validate-required"
                                                    id="billing_last_name_field" data-priority="20">
                                                    <label for="billing_last_name" class="form-label">Last name
                                                        <abbr class="required" title="required">*</abbr></label>
                                                    <input type="text" class="input-text form-control" name="lastname"
                                                        id="last_name" placeholder="" value=""
                                                        autocomplete="family-name">
                                                <p style="display: none;" style="color: red;" id="msgTwo">This feild is
                                                    required</p>

                                                </p>

                                                <p class="col-12 mb-4d75 form-row form-row-wide address-field update_totals_on_change validate-required woocommerce-validated"
                                                    id="country_field" data-priority="40">
                                                    <label for="billing_country" class="form-label">Country
                                                        <abbr class="required" title="required">*</abbr></label>
                                                    <select name="country" id="country"
                                                        class="form-control country_to_state country_select  select2-hidden-accessible"
                                                        autocomplete="country" tabindex="-1" aria-hidden="true">
                                                        <option value="">Select a country…</option>
                                                        <option value="AX">Åland Islands</option>
                                                        <option value="AF">Afghanistan</option>
                                                        <option value="AL">Albania</option>
                                                        <option value="DZ">Algeria</option>
                                                        <option value="AS">American Samoa</option>
                                                        <option value="AD">Andorra</option>
                                                        <option value="AO">Angola</option>
                                                        <option value="AI">Anguilla</option>
                                                        <option value="AQ">Antarctica</option>
                                                        <option value="AG">Antigua and Barbuda</option>
                                                        <option value="AR">Argentina</option>
                                                        <option value="AM">Armenia</option>
                                                     
                                                    </select>

                                                </p>

                                                <p class="col-12 mb-3 form-row form-row-wide address-field validate-required"
                                                    id="address_1" data-priority="50">
                                                    <label for="address_1" class="form-label">Street
                                                        address
                                                        <abbr class="required" title="required">*</abbr></label>

                                                    <input type="text" class="input-text form-control" name="address1"
                                                        id="s_address_1" placeholder="House number and street name"
                                                        value="" autocomplete="address-line1">
                                                </p>

                                                <p class="col-12 mb-4d75 form-row form-row-wide address-field"
                                                    id="billing_address_2_field" data-priority="60">
                                                    <input type="text" class="input-text form-control" name="address2"
                                                        id="s_address_2"
                                                        placeholder="Apartment, suite, unit etc. (optional)" value=""
                                                        autocomplete="address-line2">
                                                </p>

                                                <p class="col-12 mb-4d75 form-row form-row-wide address-field validate-required"
                                                    id="city_field" data-priority="70"
                                                    data-o_class="form-row form-row-wide address-field validate-required">

                                                    <label for="billing_city" class="form-label">Town / City
                                                        <abbr class="required" title="required">*</abbr></label>

                                                    <input type="text" class="input-text form-control" name="city"
                                                        id="city" placeholder="" value="" autocomplete="address-level2">
                                                </p>

                                                <p class="col-12 mb-4d75 form-row form-row-wide address-field validate-postcode validate-required"
                                                    id="postcode_field" data-priority="90"
                                                    data-o_class="form-row form-row-wide address-field validate-required validate-postcode">
                                                    <label for="billing_postcode" class="form-label">Postcode
                                                        <abbr class="required" title="required">*</abbr></label>

                                                    <input type="text" class="input-text form-control" name="postcode"
                                                        id="postcode" placeholder="" value=""
                                                        autocomplete="postal-code">
                                                </p>

                                                <p class="col-12 mb-4d75 form-row form-row-first validate-required validate-phone"
                                                    id="phone_field" data-priority="100">
                                                </p>

                                                <p class="col-12 mb-4d75 form-row form-row-last validate-required validate-email"
                                                    id="email_field" data-priority="110">

                                                    <label for="billing_email" class="form-label">Email address
                                                        <abbr class="required" title="required">*</abbr></label>

                                                    <input type="email" class="input-text form-control" name="email"
                                                        id="email" placeholder="" value="" autocomplete="email">
                                                </p>

                                            </div>
                                        </div>
                                    </div>

                                   
                                </div>

                                <h3 id="order_review_heading" class="d-none">Your order</h3>

                                <div id="order_review"
                                    class="col-md-6 col-lg-5 col-xl-4 woocommerce-checkout-review-order">
                                    <div id="checkoutAccordion" class="border border-gray-900 bg-white mb-5">

                                        <div class="p-4d875 border">
                                            <div id="checkoutHeadingOnee" class="checkout-head">
                                                <a href="#"
                                                    class="text-dark d-flex align-items-center justify-content-between"
                                                    data-toggle="collapse" data-target="#checkoutCollapseOnee"
                                                    aria-expanded="true" aria-controls="checkoutCollapseOnee">
                                                    <h3 class="checkout-title mb-0 font-weight-medium font-size-3">
                                                        Your order</h3>
                                                    <svg class="mins" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="15px"
                                                        height="2px">
                                                        <path fill-rule="evenodd" fill="rgb(22, 22, 25)"
                                                            d="M0.000,-0.000 L15.000,-0.000 L15.000,2.000 L0.000,2.000 L0.000,-0.000 Z" />
                                                    </svg>
                                                    <svg class="plus" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="15px"
                                                        height="15px">
                                                        <path fill-rule="evenodd" fill="rgb(22, 22, 25)"
                                                            d="M15.000,8.000 L9.000,8.000 L9.000,15.000 L7.000,15.000 L7.000,8.000 L0.000,8.000 L0.000,6.000 L7.000,6.000 L7.000,-0.000 L9.000,-0.000 L9.000,6.000 L15.000,6.000 L15.000,8.000 Z" />
                                                    </svg>
                                                </a>
                                            </div>


                                           <%for(var i=0; i < productDetails.items.length; i++){%>

                                                <div id="checkoutCollapseOnee"
                                                    class="mt-4 checkout-content collapse show"
                                                    aria-labelledby="checkoutHeadingOnee"
                                                    data-parent="#checkoutAccordion">

                                                    <table class="shop_table woocommerce-checkout-review-order-table">
                                                        <thead class="d-none">
                                                            <tr>
                                                                <th class="product-name"></th>
                                                                <th class="product-total">  <%=totalAmount.total%></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr class="cart_item">
                                                                <td class="product-name">
                                                                   <%=productDetails.items[i].name%>&nbsp; <strong
                                                                        class="product-quantity">: 
                                                                        <%=productDetails.items[i].quantity%></strong>
                                                                </td>
                                                                <td class="product-total">
                                                                    <span class="woocommerce-Price-amount amount"><span
                                                                            class="woocommerce-Price-currencySymbol">₹</span><span><%=productDetails.items[i].price%></span></span>
                                                                </td>
                                                            </tr>
                                                      
                                                        </tbody>
                                                        <tfoot class="d-none">
                                                            <tr class="cart-subtotal">
                                                                <th>Subtotal</th>
                                                                <td><span class="woocommerce-Price-amount amount"><span
                                                                            class="woocommerce-Price-currencySymbol">₹</span> <%=totalAmount.total%></span>
                                                                </td>
                                                            </tr>
                                                           
                                                        </tfoot>
                                                    </table>
                                                </div>
                                                <%}%>
                                        </div>

                                        <div class="p-4d875 border">
                                            <div id="checkoutHeadingOne" class="checkout-head">
                                                <a href="#"
                                                    class="text-dark d-flex align-items-center justify-content-between"
                                                    data-toggle="collapse" data-target="#checkoutCollapseOne"
                                                    aria-expanded="true" aria-controls="checkoutCollapseOne">
                                                    <h3 class="checkout-title mb-0 font-weight-medium font-size-3">
                                                        Cart Totals</h3>
                                                    <svg class="mins" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="15px"
                                                        height="2px">
                                                        <path fill-rule="evenodd" fill="rgb(22, 22, 25)"
                                                            d="M0.000,-0.000 L15.000,-0.000 L15.000,2.000 L0.000,2.000 L0.000,-0.000 Z" />
                                                    </svg>
                                                    <svg class="plus" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="15px"
                                                        height="15px">
                                                        <path fill-rule="evenodd" fill="rgb(22, 22, 25)"
                                                            d="M15.000,8.000 L9.000,8.000 L9.000,15.000 L7.000,15.000 L7.000,8.000 L0.000,8.000 L0.000,6.000 L7.000,6.000 L7.000,-0.000 L9.000,-0.000 L9.000,6.000 L15.000,6.000 L15.000,8.000 Z" />
                                                    </svg>
                                                </a>
                                            </div>

                                            <div id="checkoutCollapseOne" class="mt-4 checkout-content collapse show"
                                                aria-labelledby="checkoutHeadingOne" data-parent="#checkoutAccordion">
                                                <table class="shop_table shop_table_responsive">
                                                    <tbody>
                                                        <tr class="checkout-subtotal">
                                                            <th>Subtotal</th>
                                                            <td data-title="Subtotal"><span
                                                                    class="woocommerce-Price-amount amount"><span
                                                                        class="woocommerce-Price-currencySymbol">₹</span><%=totalAmount.total%></span>
                                                            </td>
                                                        </tr>
                                                        <tr class="order-shipping">
                                                            <th>Shipping</th>
                                                            <td data-title="Shipping">Free Shipping</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                        <div class="p-4d875 border">
                                            <div id="checkoutHeadingTwo" class="checkout-head">
                                                <a href="#"
                                                    class="text-dark d-flex align-items-center justify-content-between"
                                                    data-toggle="collapse" data-target="#checkoutCollapseTwo"
                                                    aria-expanded="false" aria-controls="checkoutCollapseTwo">
                                                    <h3 class="checkout-title mb-0 font-weight-medium font-size-3">
                                                        Shipping</h3>
                                                    <svg class="mins" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="15px"
                                                        height="2px">
                                                        <path fill-rule="evenodd" fill="rgb(22, 22, 25)"
                                                            d="M0.000,-0.000 L15.000,-0.000 L15.000,2.000 L0.000,2.000 L0.000,-0.000 Z" />
                                                    </svg>
                                                    <svg class="plus" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="15px"
                                                        height="15px">
                                                        <path fill-rule="evenodd" fill="rgb(22, 22, 25)"
                                                            d="M15.000,8.000 L9.000,8.000 L9.000,15.000 L7.000,15.000 L7.000,8.000 L0.000,8.000 L0.000,6.000 L7.000,6.000 L7.000,-0.000 L9.000,-0.000 L9.000,6.000 L15.000,6.000 L15.000,8.000 Z" />
                                                    </svg>
                                                </a>
                                            </div>
                                            <div id="checkoutCollapseTwo" class="mt-4 checkout-content collapse"
                                                aria-labelledby="checkoutHeadingTwo" data-parent="#checkoutAccordion">

                                                <ul id="shipping_method">
                                                    <li>
                                                        <input type="radio" name="shipping_method[0]" data-index="0"
                                                            id="shipping_method_0_flat_rate1" value="flat_rate:1"
                                                            class="shipping_method">
                                                        <label for="shipping_method_0_flat_rate1">Free
                                                            shipping</label>
                                                    </li>
                                                    <li>
                                                        <input type="radio" name="shipping_method[0]" data-index="0"
                                                            id="shipping_method_0_flat_rate2" value="flat_rate:2"
                                                            class="shipping_method" checked="checked">
                                                        <label for="shipping_method_0_flat_rate2">Flat rate:
                                                            <span class="woocommerce-Price-amount amount"><span
                                                                    class="woocommerce-Price-currencySymbol">$</span>15</span></label>
                                                    </li>
                                                    <li>
                                                        <input type="radio" name="shipping_method[0]" data-index="0"
                                                            id="shipping_method_0_flat_rate3" value="flat_rate:2"
                                                            class="shipping_method" checked="checked">
                                                        <label for="shipping_method_0_flat_rate3">Local pickup::
                                                            <span class="woocommerce-Price-amount amount"><span
                                                                    class="woocommerce-Price-currencySymbol">$</span>8</span></label>
                                                    </li>
                                                </ul>

                                                <span class="font-size-2">Shipping to Turkey.</span><a href="#"
                                                    class="font-weight-medium h-primary ml-3 font-size-2">Change
                                                    Address</a>
                                            </div>
                                        </div>
                                       

                                        <div class="p-4d875 border">
                                            <table class="shop_table shop_table_responsive">
                                                <tbody>
                                                    <tr class="order-total">
                                                        <th>Total</th>
                                                        <td data-title="Total"><strong><span
                                                                    class="woocommerce-Price-amount amount"><span
                                                                        class="woocommerce-Price-currencySymbol">₹</span>
                                                                 <span id="totalprice">  <%=totalAmount.total%></span> 
                                                                </span></strong>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="p-4d875 border">
                                            <div id="checkoutHeadingThreee" class="checkout-head">
                                                <a href="#"
                                                    class="text-dark d-flex align-items-center justify-content-between"
                                                    data-toggle="collapse" data-target="#checkoutCollapseThreee"
                                                    aria-expanded="true" aria-controls="checkoutCollapseThreee">
                                                    <h3 class="checkout-title mb-0 font-weight-medium font-size-3">
                                                        Payment</h3>
                                                    <svg class="mins" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="15px"
                                                        height="2px">
                                                        <path fill-rule="evenodd" fill="rgb(22, 22, 25)"
                                                            d="M0.000,-0.000 L15.000,-0.000 L15.000,2.000 L0.000,2.000 L0.000,-0.000 Z" />
                                                    </svg>
                                                    <svg class="plus" xmlns="http://www.w3.org/2000/svg"
                                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="15px"
                                                        height="15px">
                                                        <path fill-rule="evenodd" fill="rgb(22, 22, 25)"
                                                            d="M15.000,8.000 L9.000,8.000 L9.000,15.000 L7.000,15.000 L7.000,8.000 L0.000,8.000 L0.000,6.000 L7.000,6.000 L7.000,-0.000 L9.000,-0.000 L9.000,6.000 L15.000,6.000 L15.000,8.000 Z" />
                                                    </svg>
                                                </a>
                                            </div>
                                            <div id="checkoutCollapseThreee" class="mt-4 checkout-content collapse show"
                                                aria-labelledby="checkoutHeadingThreee"
                                                data-parent="#checkoutAccordion">
                                                <div id="payment" class="woocommerce-checkout-payment">
                                                    <ul class="wc_payment_methods payment_methods methods">

                                                        <li class="wc_payment_method payment_method_cheque">
                                                            <input id="payment_method_cheque" type="radio"
                                                                class="input-radio" name="payment_method" value="online"
                                                                data-order_button_text="">
                                                            <label for="payment_method_cheque">UPI payments
                                                            </label>
                                                            <div class="payment_box payment_method_cheque"
                                                                style="display: block;">
                                                                <p>Please send a check to Store Name, Store
                                                                    Street,
                                                                    Store Town, Store State / County, Store
                                                                    Postcode.</p>
                                                            </div>
                                                        </li>


                                                        <li class="wc_payment_method payment_method_cod">
                                                            <input id="payment_method_cod" type="radio"
                                                                class="input-radio" name="payment_method" value="cod"
                                                                checked="checked" data-order_button_text="">
                                                            <label for="payment_method_cod">Cash on delivery
                                                            </label>
                                                            <div class="payment_box payment_method_cod"
                                                                style="display: block;">
                                                                <p>Pay with cash upon delivery.</p>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-row place-order">

                                        <button type="submit"
                                            class="button alt btn btn-dark btn-block rounded-0 py-4">Place
                                            order</button>



                                        <input type="hidden" id="_wpnonce" name="_wpnonce" value="926470d564"><input
                                            type="hidden" name="_wp_http_referer"
                                            value="/storefront/?wc-ajax=update_order_review">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                </article>

            </main>

        </div>

    </div>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>


    $('#checkout_form').submit((ab) => {
        ab.preventDefault()

        $.ajax({

            url: '/checkout',
            method: 'POST',
            data: $('#checkout_form').serialize(), //to get all form data with thw help of serialize

            success: (response) => {
                if (response.status == 'cod-success'){
                    window.location.href = 'ordersuccess?id='+response.orderId
                }else{
                    console.log(response)
                    razorpayPayment(response)
                }
            }
        })
    })


    function razorpayPayment(order) {
        console.log('hai');
        console.log(order)
        console.log(order.id);
        console.log(order.amount);
        var options = {
            "key": "rzp_test_u78E67f6nj6E0c", // Enter the Key ID generated from the Dashboard
            "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
            "currency": "INR",
            "name": "BOOKWORM",
            "description": "Test Transaction",
            "image": "https://example.com/your_logo",
            "order_id": order.id,
            // "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
            "handler": function (response) {
               
               
                verifyPayment(response, order)
            },
            "prefill": {
                "name": "Gaurav Kumar",
                "email": "gaurav.kumar@example.com",
                "contact": "9999999999"
            },
            "notes": {
                "address": "Razorpay Corporate Office"
            },
            "theme": {
                "color": "#3399cc"
            }
        };

        var rzp1 = new Razorpay(options)
        rzp1.open()
    }


    function verifyPayment(payment, order) {
        console.log('inside verify payment ajax')
        $.ajax({
            url: '/verifyPayment',
            data: {
                payment,
                order
            },
            method: 'post',
            success: (resolve) => {
                console.log(resolve)
                if (resolve.status == 'success') {
                    console.log('hello')
                    const orderId = resolve.orderId
                    console.log(orderId)
                    window.location = href = '/orderSuccess?id='+orderId
                }
                else {
                    console.log('payment failed')
                }
            }
        })
    }

function applyCoupon(){
    let coupon=document.getElementById('coupon_code1').value
    let price=document.getElementById('totalprice').innerHTML
    $.ajax({
      url: "applycoupon",
      data: {
        coupon,
        price,
      },
      method: "post",
      success: (resolve) => {
        if(resolve.price){
            console.log(resolve);
    document.getElementById('totalprice').innerHTML=resolve.price
        }else{
            document.getElementById('Message').innerHTML=resolve.Message
        }
 
      },
    });
}

</script>